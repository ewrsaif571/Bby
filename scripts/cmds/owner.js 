const https = require("https");
const fs = require("fs-extra");
const path = require("path");
const moment = require("moment");

const ownerInfo = {
  name: "ùêí'ùêö!ùêÖ ùêàùê¨ùê•'ùêöùê¶",
  age: "ùüèùüî",
  birthday: "ùüêùüéùüéùüó - ùüéùüì - ùüéùüè",
  height: "ùüì - ùüì",
  location: "ùêíùê¢ùê´ùêöùê£ùê†ùêöùêßùê£",
  class: "ùüó",
  hobby: "ùêèùê®ùê®ùê´ ùê§ùê¢ùêù >‚Å†.‚Å†<",
  relationship: "ùêíùê¢ùêßùê†ùê•ùêû",
  dream: "ùêçùê®ùê≠ùê°ùê¢ùêßùê†",
  favAnime: "ùêÄùê≠ùê≠ùêöùêúùê§ ùê®ùêß ùê≠ùê¢ùê≠ùêöùêß",
  gender: "ùêÅùê®ùê≤",
  facebook: "https://www.facebook.com/saif.islam404",
  botname: "ùêå'ùê¢ùê§ùêöùêí'ùêö"
};

const mediaLinks = [
  "https://i.imgur.com/qoHWIOD.mp4",
  "https://i.imgur.com/uTdA4LU.mp4",
  "https://i.imgur.com/2fRehnn.mp4",
  "https://i.imgur.com/mSphvOL.mp4",
  "https://i.imgur.com/P4W63mi.mp4",
  "https://i.imgur.com/v6BFWAj.mp4",
  "https://i.imgur.com/s6bV3eI.mp4"
];

module.exports = {
  config: {
    name: "owner",
    aliases: ["owner"],
    version: "1.2",
    author: "Sa!F ü™∂",
    role: 0,
    shortDescription: "Show owner info",
    category: "info",
    guide: { en: "{pn}" }
  },

  onStart: async function ({ message }) {
    const start = Date.now();

    try {
      const uptime = process.uptime();
      const duration = moment.duration(uptime, "seconds");
      const uptimeText = `${duration.hours()}h ${duration.minutes()}m ${duration.seconds()}s`;

      const randomIndex = Math.floor(Math.random() * mediaLinks.length);
      const videoUrl = mediaLinks[randomIndex];
      const ext = path.extname(videoUrl).split("?")[0] || ".mp4";
      const cachePath = path.join(__dirname, "cache", `owner_video${ext}`);

      await fs.ensureDir(path.join(__dirname, "cache"));
      const file = fs.createWriteStream(cachePath);

      https.get(videoUrl, (response) => {
        response.pipe(file);
        file.on("finish", () => {
          file.close(() => {
            const ping = Date.now() - start;

            const infoText = `
ùêéùêñùêçùêÑùêë ùêàùêçùêÖùêé ü•∑
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ùêçùêöùê¶ùêû: ${ownerInfo.name}
ùêÄùê†ùêû: ${ownerInfo.age}
ùêÅùê¢ùê´ùê≠ùê°ùêùùêöùê≤: ${ownerInfo.birthday}
ùêáùêûùê¢ùê†ùê°ùê≠: ${ownerInfo.height}
ùêãùê®ùêúùêöùê≠ùê¢ùê®ùêß: ${ownerInfo.location}
ùêÇùê•ùêöùê¨ùê¨: ${ownerInfo.class}
ùêÜùêûùêßùêùùêûùê´: ${ownerInfo.gender}
ùêÅùê¢ùê®: ${ownerInfo.hobby}
ùêëùêûùê•ùêöùê≠ùê¢ùê®ùêßùê¨ùê°ùê¢ùê©: ${ownerInfo.relationship}
ùêÉùê´ùêûùêöùê¶: ${ownerInfo.dream}
ùêÖùêöùêØ ùêÄùêßùê¢ùê¶ùêû: ${ownerInfo.favAnime}
ùêÖùêöùêúùêûùêõùê®ùê®ùê§: ${ownerInfo.facebook}

ùêÅùêéùêì ùêàùêçùêÖùêé 
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ùêÅùê®ùê≠ ùêçùêöùê¶ùêû: ${ownerInfo.botname}
ùêîùê©ùê≠ùê¢ùê¶ùêû: ${uptimeText}
ùêèùê¢ùêßùê†: ${ping} ms
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;

            return message.reply({
              body: infoText,
              attachment: fs.createReadStream(cachePath)
            });
          });
        });
      }).on("error", (err) => {
        console.error("‚ùå Download error:", err.message);
        return message.reply("‚ùå | ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
      });

    } catch (e) {
      console.error("‚ùå Unexpected error:", e);
      return message.reply("‚ùå | ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶è‡¶ï‡¶ü‡¶æ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
    }
  }
};